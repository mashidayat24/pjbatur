<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Search App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <style>
        .pdf-container {
            height: 80vh;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        #pdf-viewer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">PDF Search Application</h1>
            <p class="text-gray-600">Search and view PDF documents from the database</p>
        </header>

        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="Search PDF files..." 
                    class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <button 
                    id="search-btn" 
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                    Search
                </button>
            </div>
        </div>

        <div id="results-container" class="mb-8 hidden">
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h2 class="text-lg font-semibold text-gray-800">Search Results</h2>
                </div>
                <ul id="results-list" class="divide-y divide-gray-200"></ul>
            </div>
        </div>

        <div id="pdf-viewer-container" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 id="pdf-title" class="text-xl font-semibold text-gray-800"></h2>
                <button 
                    id="back-btn" 
                    class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Back to Results
                </button>
            </div>
            <div class="pdf-container">
                <iframe id="pdf-viewer" frameborder="0"></iframe>
            </div>
        </div>
    </div>

    <script>
        const githubRepo = 'mashidayat24/pjbatur';
        const databaseFolder = 'database';

        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('results-list');
        const pdfViewerContainer = document.getElementById('pdf-viewer-container');
        const pdfViewer = document.getElementById('pdf-viewer');
        const pdfTitle = document.getElementById('pdf-title');
        const backBtn = document.getElementById('back-btn');

        async function searchPDFs(query = '') {
            try {
                const response = await fetch(`https://api.github.com/repos/${githubRepo}/contents/${databaseFolder}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch repository contents');
                }
                
                const files = await response.json();
                
                const pdfFiles = files.filter(file => 
                    file.name.toLowerCase().includes(query.toLowerCase()) && 
                    file.name.toLowerCase().endsWith('.pdf')
                );
                
                return pdfFiles;
            } catch (error) {
                console.error('Error searching PDFs:', error);
                return [];
            }
        }

        function displayResults(files) {
            resultsList.innerHTML = '';
            
            if (files.length === 0) {
                resultsList.innerHTML = '<li class="px-6 py-4 text-gray-500">No PDF files found</li>';
                return;
            }
            
            files.forEach(file => {
                const listItem = document.createElement('li');
                listItem.className = 'px-6 py-4 hover:bg-gray-50 cursor-pointer';
                listItem.innerHTML = `
                    <div class="flex items-center">
                        <img 
                            src="https://placehold.co/40" 
                            alt="PDF document icon" 
                            class="w-8 h-8 mr-3"
                            onerror="this.src='https://placehold.co/40'"
                        >
                        <div>
                            <h3 class="text-gray-800 font-medium">${file.name}</h3>
                            <p class="text-sm text-gray-500">${(file.size / 1024).toFixed(1)} KB</p>
                        </div>
                    </div>
                `;
                
                listItem.addEventListener('click', () => viewPDF(file));
                resultsList.appendChild(listItem);
            });
        }

        function viewPDF(file) {
            pdfTitle.textContent = file.name;
            pdfViewer.src = `https://docs.google.com/gview?url=${file.download_url}&embedded=true`;
            
            resultsContainer.classList.add('hidden');
            pdfViewerContainer.classList.remove('hidden');
        }

        function backToResults() {
            pdfViewer.src = '';
            resultsContainer.classList.remove('hidden');
            pdfViewerContainer.classList.add('hidden');
        }

        searchBtn.addEventListener('click', async () => {
            const query = searchInput.value.trim();
            const results = await searchPDFs(query);
            
            displayResults(results);
            resultsContainer.classList.remove('hidden');
            pdfViewerContainer.classList.add('hidden');
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });
        
        backBtn.addEventListener('click', backToResults);
    </script>
</body>
</html>
