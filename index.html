<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Search Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --light-color: #e8f1f2;
            --dark-color: #0d1b2a;
            --accent-color: #5c9ead;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        input[type="text"] {
            flex-grow: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--accent-color);
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            height: calc(100vh - 220px);
        }
        
        .file-list {
            width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            overflow-y: auto;
        }
        
        .file-list h2 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        
        .pdf-item {
            padding: 10px;
            margin-bottom: 8px;
            background-color: var(--light-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pdf-item:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        .pdf-item.selected {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .pdf-viewer-container {
            flex-grow: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .pdf-viewer {
            flex-grow: 1;
            border: 1px solid #ddd;
            margin-top: 15px;
            overflow: auto;
            position: relative;
        }
        
        .pdf-document {
            width: 100%;
        }
        
        .pdf-page {
            margin-bottom: 20px;
        }
        
        .search-results {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .search-result-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: #f8f8f8;
            border-left: 3px solid var(--accent-color);
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background-color: #e5f3f7;
        }
        
        .search-highlight {
            background-color: yellow;
        }
        
        .no-results {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        
        .file-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            
            .file-list {
                width: 100%;
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PDF Search Viewer</h1>
            <p>Cari dan baca konten dari file PDF Anda</p>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Cari teks dalam PDF...">
                <button id="searchButton">Cari</button>
                <button id="loadFilesButton">Pilih Folder PDF</button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="file-list">
                <h2>Daftar File PDF</h2>
                <div id="pdfList">
                    <div class="no-results">Pilih folder yang berisi file PDF</div>
                </div>
            </div>
            
            <div class="pdf-viewer-container">
                <h2 id="currentPdfTitle">PDF Viewer</h2>
                <div class="file-actions">
                    <div>
                        <span id="pageInfo">Halaman: -/-</span>
                    </div>
                    <div>
                        <button id="prevPage">Sebelumnya</button>
                        <button id="nextPage">Selanjutnya</button>
                    </div>
                </div>
                <div class="pdf-viewer" id="pdfViewer">
                    <div class="no-results">Tidak ada PDF yang dipilih</div>
                </div>
                
                <div id="searchResultsContainer" style="display: none;">
                    <h3>Hasil Pencarian</h3>
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inisialisasi PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
        
        let pdfDocuments = [];
        let currentPdf = null;
        let currentPage = 1;
        let searchResults = [];
        let currentSearchIndex = -1;
        let directoryHandle = null;
        
        // DOM Elements
        const pdfListElement = document.getElementById('pdfList');
        const pdfViewerElement = document.getElementById('pdfViewer');
        const currentPdfTitleElement = document.getElementById('currentPdfTitle');
        const pageInfoElement = document.getElementById('pageInfo');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const loadFilesButton = document.getElementById('loadFilesButton');
        const prevPageButton = document.getElementById('prevPage');
        const nextPageButton = document.getElementById('nextPage');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const searchResultsElement = document.getElementById('searchResults');
        
        // Event Listeners
        loadFilesButton.addEventListener('click', async () => {
            try {
                directoryHandle = await window.showDirectoryPicker();
                await loadPdfFiles();
            } catch (error) {
                console.error('Error accessing directory:', error);
                alert('Gagal mengakses folder. Pastikan browser mendukung fitur ini dan Anda memberikan izin yang diperlukan.');
            }
        });
        
        searchButton.addEventListener('click', () => {
            const searchTerm = searchInput.value.trim();
            if (searchTerm && currentPdf) {
                searchInPdf(searchTerm);
            }
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const searchTerm = searchInput.value.trim();
                if (searchTerm && currentPdf) {
                    searchInPdf(searchTerm);
                }
            }
        });
        
        prevPageButton.addEventListener('click', () => {
            if (currentPdf && currentPage > 1) {
                currentPage--;
                renderPage();
                updatePageInfo();
            }
        });
        
        nextPageButton.addEventListener('click', () => {
            if (currentPdf && currentPage < currentPdf.numPages) {
                currentPage++;
                renderPage();
                updatePageInfo();
            }
        });
        
        // Functions
        async function loadPdfFiles() {
            pdfDocuments = [];
            pdfListElement.innerHTML = '';
            
            try {
                for await (const entry of directoryHandle.values()) {
                    if (entry.name.endsWith('.pdf')) {
                        const fileHandle = entry;
                        const file = await fileHandle.getFile();
                        
                        const reader = new FileReader();
                        reader.onload = async function(e) {
                            try {
                                const typedArray = new Uint8Array(e.target.result);
                                const pdfDoc = await pdfjsLib.getDocument(typedArray).promise;
                                
                                pdfDocuments.push({
                                    name: entry.name,
                                    handle: fileHandle,
                                    pdfDoc: pdfDoc
                                });
                                
                                renderPdfList();
                            } catch (error) {
                                console.error('Error loading PDF:', error);
                            }
                        };
                        reader.readAsArrayBuffer(file);
                    }
                }
            } catch (error) {
                console.error('Error reading directory:', error);
            }
        }
        
        function renderPdfList() {
            if (pdfDocuments.length === 0) {
                pdfListElement.innerHTML = '<div class="no-results">Tidak ada file PDF yang ditemukan</div>';
                return;
            }
            
            pdfListElement.innerHTML = '';
            pdfDocuments.forEach((pdfDoc, index) => {
                const pdfItem = document.createElement('div');
                pdfItem.className = 'pdf-item';
                pdfItem.textContent = pdfDoc.name;
                pdfItem.addEventListener('click', () => {
                    document.querySelectorAll('.pdf-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    pdfItem.classList.add('selected');
                    loadPdf(pdfDoc);
                });
                pdfListElement.appendChild(pdfItem);
            });
        }
        
        async function loadPdf(pdfDoc) {
            try {
                currentPdf = pdfDoc.pdfDoc;
                currentPage = 1;
                currentPdfTitleElement.textContent = pdfDoc.name;
                updatePageInfo();
                await renderPage();
                searchResultsContainer.style.display = 'none';
            } catch (error) {
                console.error('Error loading PDF:', error);
                pdfViewerElement.innerHTML = '<div class="no-results">Gagal memuat PDF</div>';
            }
        }
        
        async function renderPage() {
            if (!currentPdf) return;
            
            try {
                const page = await currentPdf.getPage(currentPage);
                const viewport = page.getViewport({ scale: 1.0 });
                
                // Adjust scale to fit width
                const scale = pdfViewerElement.clientWidth / viewport.width;
                const scaledViewport = page.getViewport({ scale });
                
                pdfViewerElement.innerHTML = '';
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;
                pdfViewerElement.appendChild(canvas);
                
                await page.render({
                    canvasContext: context,
                    viewport: scaledViewport
                }).promise;
            } catch (error) {
                console.error('Error rendering page:', error);
                pdfViewerElement.innerHTML = '<div class="no-results">Gagal merender halaman PDF</div>';
            }
        }
        
        function updatePageInfo() {
            if (currentPdf) {
                pageInfoElement.textContent = `Halaman: ${currentPage}/${currentPdf.numPages}`;
            } else {
                pageInfoElement.textContent = 'Halaman: -/-';
            }
        }
        
        async function searchInPdf(searchTerm) {
            if (!currentPdf) return;
            
            searchResults = [];
            searchResultsElement.innerHTML = '';
            searchResultsContainer.style.display = 'block';
            
            try {
                // Search in all pages
                for (let i = 1; i <= currentPdf.numPages; i++) {
                    const page = await currentPdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const text = textContent.items.map(item => item.str).join(' ');
                    
                    if (text.toLowerCase().includes(searchTerm.toLowerCase())) {
                        // Find all occurrences
                        const regex = new RegExp(searchTerm, 'gi');
                        let match;
                        while ((match = regex.exec(text)) !== null) {
                            searchResults.push({
                                page: i,
                                position: match.index,
                                text: match[0]
                            });
                        }
                    }
                }
                
                if (searchResults.length === 0) {
                    searchResultsElement.innerHTML = '<div class="no-results">Tidak ditemukan hasil pencarian</div>';
                    return;
                }
                
                // Display search results
                searchResults.forEach((result, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    
                    const previewText = result.position < 20 
                        ? `..."${result.text}"` + result.text.substr(20, 50) + "..."
                        : "..." + text.substr(result.position - 20, 50) + `"${result.text}"` + "...";
                    
                    resultItem.innerHTML = `
                        <strong>Halaman ${result.page}:</strong> ${previewText}
                    `;
                    
                    resultItem.addEventListener('click', () => {
                        currentPage = result.page;
                        renderPage();
                        updatePageInfo();
                        highlightSearchTerm(searchTerm);
                        currentSearchIndex = index;
                        scrollToHighlight();
                    });
                    
                    searchResultsElement.appendChild(resultItem);
                });
                
            } catch (error) {
                console.error('Error searching PDF:', error);
                searchResultsElement.innerHTML = '<div class="no-results">Gagal melakukan pencarian</div>';
            }
        }
        
        function highlightSearchTerm(term) {
            if (!currentPdf) return;
            
            const textDivs = pdfViewerElement.querySelectorAll('.textLayer div');
            const regex = new RegExp(term, 'gi');
            
            textDivs.forEach(div => {
                const text = div.textContent;
                if (text.match(regex)) {
                    div.innerHTML = text.replace(regex, match => 
                        `<span class="search-highlight">${match}</span>`
                    );
                }
            });
        }
        
        function scrollToHighlight() {
            const highlights = pdfViewerElement.querySelectorAll('.search-highlight');
            if (highlights.length > 0 && currentSearchIndex >= 0 && currentSearchIndex < highlights.length) {
                highlights[currentSearchIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }
    </script>
</body>
</html>

